{% extends "base.html" %}
{% block title %}Horoscope | Astro AI{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card shadow-lg border-0 astro-card">
        <div class="card-body">
          <h3 class="text-center shimmer">üåå Daily Horoscope</h3>

          <!-- Zodiac Sign Selector -->
          <div class="mb-3 text-center">
            <label for="zodiac-select" class="form-label">Select Your Zodiac Sign:</label>
            <select id="zodiac-select" class="form-select w-50 mx-auto">
              <option value="" disabled selected>Choose...</option>
              <option>Aries ‚ôà</option>
              <option>Taurus ‚ôâ</option>
              <option>Gemini ‚ôä</option>
              <option>Cancer ‚ôã</option>
              <option>Leo ‚ôå</option>
              <option>Virgo ‚ôç</option>
              <option>Libra ‚ôé</option>
              <option>Scorpio ‚ôè</option>
              <option>Sagittarius ‚ôê</option>
              <option>Capricorn ‚ôë</option>
              <option>Aquarius ‚ôí</option>
              <option>Pisces ‚ôì</option>
            </select>
          </div>

          <!-- Horoscope Result -->
          <div id="horoscope-box" class="p-3 bg-dark text-light rounded" style="min-height:150px;">
            üîÆ Select your sign to reveal today‚Äôs horoscope...
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const zodiacSelect = document.getElementById("zodiac-select");
  const horoscopeBox = document.getElementById("horoscope-box");

  zodiacSelect.addEventListener("change", async function () {
    const sign = zodiacSelect.value;
    horoscopeBox.innerHTML = "‚è≥ Loading your horoscope...";

    try {
      const response = await fetch("{% url 'chat_api' %}", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": "{{ csrf_token }}",
        },
        body: JSON.stringify({ message: `Give me today's horoscope for ${sign}` }),
      });

      const data = await response.json();
      let reply = data.reply
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/\n/g, "<br>")
        .replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>");

      horoscopeBox.innerHTML = reply;
    } catch (err) {
      horoscopeBox.innerHTML = "‚ö†Ô∏è Error fetching horoscope. Please try again.";
    }
  });
});
</script>
{% endblock %}
